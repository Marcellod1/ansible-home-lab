- name: Create {{ target_dir }}
  become: true
  ansible.builtin.file:
    path: "{{ target_dir }}"
    mode: '775'
    group: docker
    state: directory
  vars:
    target_dir: "{{ docker_directory | regex_replace('/+$', '') }}/{{ container_name }}"

- name: Start container {{ container_name }}
  become: true
  community.docker.docker_container:
    name: "{{ container_name }}"
    image: jc21/nginx-proxy-manager:latest
    state: started
    restart: true
    ports:
      - 80:80
      - 81:81
      - 443:443
    mounts:
      - target: /data
        type: volume
      - target: /etc/letsencrypt
        type: volume
